name: Tester
permissions:
  contents: read
  packages: read

on:
  workflow_call:

jobs:
  enhetstester:
    name: Vitest matrix
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
      matrix:
        group:
          - fakta
          - prosess
          - behandling
          - v2
          - base
          - øvrig
    steps:
      - name: Hente kode
        uses: actions/checkout@v5

      - name: Setup + Install
        uses: ./.github/actions/setup-install
        with:
          npmAuthToken: ${{ secrets.READER_TOKEN }}

      - name: Kjører tester (${ { matrix.group } })
        env:
          # Ensure CI flag is true so vite.config enables thread pool + json reporter
          CI: true
        run: |
          case "${{ matrix.group }}" in
            fakta)
              yarn test --silent=true "packages/fakta-*/**/*.spec.*" ;;
            prosess)
              yarn test --silent=true "packages/prosess-*/**/*.spec.*" ;;
            behandling)
              yarn test --silent=true "packages/behandling-*/**/*.spec.*" ;;
            v2)
              yarn test --silent=true "packages/v2/**/*.spec.*" ;;
            base)
              yarn test --silent=true "packages/utils/**" "packages/form/**" "packages/rest-api*/**" "packages/rest-api-hooks/**" ;;
            øvrig)
              yarn test --silent=true "packages/shared-components/**" "packages/modal-sett-pa-vent/**" "packages/sak-app/**/!(app)/**/*.spec.*" "packages/ung/**/!(app)/**/*.spec.*" ;;
          esac
