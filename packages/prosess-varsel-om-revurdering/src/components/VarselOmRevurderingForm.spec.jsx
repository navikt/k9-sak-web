import React from 'react';
import { expect } from 'chai';
import sinon from 'sinon';

import { reduxFormPropsMock } from '@fpsak-frontend/utils-test/src/redux-form-test-helper';

import behandlingType from '@fpsak-frontend/kodeverk/src/behandlingType';
import { VarselOmRevurderingFormImpl as UnwrappedForm } from './VarselOmRevurderingForm';
import shallowWithIntl, { intlMock } from '../../i18n';

const soknad = {
  fodselsdatoer: { 1: '2019-01-10' },
  termindato: '2019-01-01',
  utstedtdato: '2019-01-02',
  antallBarn: 1,
};

const originalBehandling = {
  soknad,
  familiehendelse: {
    termindato: '2019-01-01',
    fodselsdato: '2019-01-10',
    antallBarnTermin: 1,
    antallBarnFodsel: 1,
  },
};

describe('<VarselOmRevurderingFormImpl>', () => {
  it('skal vise fritekst og forh책ndsvis av brev n책r varsel skal sendes', () => {
    const wrapper = shallowWithIntl(
      <UnwrappedForm
        {...reduxFormPropsMock}
        intl={intlMock}
        previewCallback={sinon.spy()}
        dispatchSubmitFailed={sinon.spy()}
        erAutomatiskRevurdering={false}
        languageCode="NN"
        readOnly={false}
        sendVarsel
        frist="2017-05-15"
        aksjonspunktStatus="OPPR"
        begrunnelse="Begrunnelse"
        avklartBarn={[]}
        behandlingTypeKode={behandlingType.FORSTEGANGSSOKNAD}
        soknad={soknad}
        termindato="2019-01-01"
        soknadOriginalBehandling={originalBehandling.soknad}
        familiehendelseOriginalBehandling={originalBehandling.familiehendelse}
        vedtaksDatoSomSvangerskapsuke="2019-01-01"
      />,
    );

    const textarea = wrapper.find('TextAreaField');
    const forhandsvis = wrapper.find('a');
    expect(textarea).to.have.length(2);
    expect(forhandsvis).to.have.length(1);
  });

  it('skal ikke vise fritekst og forh책ndsvis av brev n책r varsel ikke skal sendes', () => {
    const wrapper = shallowWithIntl(
      <UnwrappedForm
        {...reduxFormPropsMock}
        intl={intlMock}
        previewCallback={sinon.spy()}
        dispatchSubmitFailed={sinon.spy()}
        erAutomatiskRevurdering={false}
        languageCode="NN"
        readOnly={false}
        sendVarsel={false}
        frist="2017-05-15"
        aksjonspunktStatus="OPPR"
        begrunnelse="Begrunnelse"
        avklartBarn={[]}
        behandlingTypeKode={behandlingType.FORSTEGANGSSOKNAD}
        soknad={soknad}
        termindato="2019-01-01"
        soknadOriginalBehandling={originalBehandling.soknad}
        familiehendelseOriginalBehandling={originalBehandling.familiehendelse}
        vedtaksDatoSomSvangerskapsuke="2019-01-01"
      />,
    );

    const textarea = wrapper.find('TextAreaField');
    const forhandsvis = wrapper.find('a');
    expect(textarea).to.have.length(1);
    expect(forhandsvis).to.have.length(0);
  });

  it('skal vises i readonly visning', () => {
    const begrunnelse = 'Begrunnelse';
    const wrapper = shallowWithIntl(
      <UnwrappedForm
        {...reduxFormPropsMock}
        intl={intlMock}
        previewCallback={sinon.spy()}
        dispatchSubmitFailed={sinon.spy()}
        erAutomatiskRevurdering={false}
        languageCode="NN"
        readOnly={false}
        sendVarsel={false}
        frist="2017-05-15"
        aksjonspunktStatus="UTFRT"
        begrunnelse={begrunnelse}
        avklartBarn={[]}
        behandlingTypeKode={behandlingType.FORSTEGANGSSOKNAD}
        soknad={soknad}
        termindato="2019-01-01"
        soknadOriginalBehandling={originalBehandling.soknad}
        familiehendelseOriginalBehandling={originalBehandling.familiehendelse}
        vedtaksDatoSomSvangerskapsuke="2019-01-01"
      />,
    );

    expect(wrapper.find('Undertekst')).to.have.length(1);
    expect(wrapper.find('Normaltekst')).to.have.length(1);
    expect(wrapper.find('Normaltekst').children().text()).to.equal(begrunnelse);
  });
});
